<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片压缩功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>图片压缩功能测试</h1>
    
    <div class="test-section">
        <h2>基础压缩测试</h2>
        <input type="file" id="testFile" accept="image/*">
        <button class="test-button" onclick="testBasicCompression()">测试基础压缩</button>
        <div id="basicResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Canvas压缩测试</h2>
        <button class="test-button" onclick="testCanvasCompression()">测试Canvas压缩</button>
        <div id="canvasResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>格式转换测试</h2>
        <button class="test-button" onclick="testFormatConversion()">测试格式转换</button>
        <div id="formatResult" class="result"></div>
    </div>

    <script>
        // 基础压缩测试
        function testBasicCompression() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请先选择图片文件');
                return;
            }

            const resultDiv = document.getElementById('basicResult');
            resultDiv.innerHTML = `
                <h3>文件信息：</h3>
                <p>文件名：${file.name}</p>
                <p>文件大小：${(file.size / 1024).toFixed(2)} KB</p>
                <p>文件类型：${file.type}</p>
            `;
        }

        // Canvas压缩测试
        function testCanvasCompression() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请先选择图片文件');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                // 设置canvas尺寸
                canvas.width = img.width * 0.5; // 压缩到50%
                canvas.height = img.height * 0.5;

                // 绘制图片
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                // 转换为blob
                canvas.toBlob(function(blob) {
                    const resultDiv = document.getElementById('canvasResult');
                    resultDiv.innerHTML = `
                        <h3>Canvas压缩结果：</h3>
                        <p>原始大小：${(file.size / 1024).toFixed(2)} KB</p>
                        <p>压缩后大小：${(blob.size / 1024).toFixed(2)} KB</p>
                        <p>压缩率：${((file.size - blob.size) / file.size * 100).toFixed(1)}%</p>
                        <p>原始尺寸：${img.width} x ${img.height}</p>
                        <p>压缩后尺寸：${canvas.width} x ${canvas.height}</p>
                        <img src="${URL.createObjectURL(blob)}" class="image-preview" alt="压缩后预览">
                    `;
                }, 'image/jpeg', 0.8);
            };

            img.src = URL.createObjectURL(file);
        }

        // 格式转换测试
        function testFormatConversion() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请先选择图片文件');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                // 测试不同格式
                const formats = [
                    { name: 'JPEG', mime: 'image/jpeg', quality: 0.8 },
                    { name: 'PNG', mime: 'image/png', quality: 1.0 },
                    { name: 'WEBP', mime: 'image/webp', quality: 0.8 }
                ];

                let results = '<h3>格式转换测试结果：</h3>';
                
                formats.forEach((format, index) => {
                    canvas.toBlob(function(blob) {
                        results += `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
                                <h4>${format.name}格式：</h4>
                                <p>文件大小：${(blob.size / 1024).toFixed(2)} KB</p>
                                <p>压缩率：${((file.size - blob.size) / file.size * 100).toFixed(1)}%</p>
                                <img src="${URL.createObjectURL(blob)}" class="image-preview" alt="${format.name}预览">
                            </div>
                        `;
                        
                        if (index === formats.length - 1) {
                            document.getElementById('formatResult').innerHTML = results;
                        }
                    }, format.mime, format.quality);
                });
            };

            img.src = URL.createObjectURL(file);
        }
    </script>
</body>
</html> 