# 图片压缩功能说明

## 功能概述

图片压缩功能是一个纯前端的图片处理工具，支持对JPG、PNG、WEBP、GIF等格式的图片进行智能压缩，在减小文件大小的同时保持图片质量。

## 主要特性

### 1. 智能压缩
- 支持多种图片格式：JPG、PNG、WEBP、GIF
- 可调节压缩质量（10%-100%）
- 支持尺寸调整和比例保持
- 实时预览压缩效果

### 2. 批量处理
- 支持多张图片同时上传
- 批量压缩后自动打包下载
- 进度显示和状态提示

### 3. 预览对比
- 原图与压缩后图片对比预览
- 详细的压缩信息显示
- 文件大小和尺寸变化统计

### 4. 历史记录
- 自动保存压缩历史
- 支持重复下载和删除
- 本地存储，保护隐私

## 技术实现

### 核心技术
- **Canvas API**：用于图片处理和格式转换
- **File API**：处理文件上传和拖拽
- **Blob API**：生成压缩后的文件
- **JSZip**：批量文件打包下载

### 压缩算法
1. **尺寸压缩**：通过调整图片尺寸减小文件大小
2. **质量压缩**：通过降低JPEG质量参数减小文件大小
3. **格式优化**：选择合适的输出格式（JPG/PNG/WEBP）

### 处理流程
```
上传图片 → 参数设置 → Canvas处理 → 格式转换 → 下载文件
```

## 使用方法

### 1. 上传图片
- 点击"选择图片"按钮选择文件
- 或直接拖拽图片到上传区域
- 支持多选文件进行批量处理

### 2. 设置参数
- **压缩质量**：拖动滑块调节压缩质量（10%-100%）
- **目标尺寸**：选择预设尺寸或自定义尺寸
- **输出格式**：选择JPG、PNG或WEBP格式
- **保持比例**：勾选后自动保持图片比例

### 3. 预览和压缩
- 上传后自动显示原图和压缩后预览
- 调节参数时实时更新预览效果
- 点击"开始压缩"下载单个文件
- 点击"批量压缩"处理多个文件

## 文件结构

```
pages/
├── image-compress.html          # 图片压缩页面
css/
├── image-compress.css           # 图片压缩样式
js/
├── image-compress.js            # 图片压缩功能
lib/
├── jszip.js                     # ZIP文件处理库
```

## 功能模块

### 1. 文件上传模块
- 支持拖拽上传
- 文件类型验证
- 文件大小限制（20MB）
- 多文件选择

### 2. 参数设置模块
- 质量滑块控制
- 尺寸预设选择
- 格式选择
- 比例保持选项

### 3. 预览模块
- 原图预览
- 压缩后预览
- 信息对比显示
- 实时更新

### 4. 压缩处理模块
- Canvas图片处理
- 格式转换
- 质量调节
- 尺寸调整

### 5. 历史记录模块
- 本地存储
- 记录管理
- 重复下载
- 记录删除

## 性能优化

### 1. 内存管理
- 及时释放Canvas资源
- 清理Blob URL
- 限制同时处理的文件数量

### 2. 用户体验
- 加载状态提示
- 进度显示
- 错误处理
- 响应式设计

### 3. 兼容性
- 支持主流浏览器
- 移动端适配
- 触摸操作支持

## 浏览器支持

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 使用限制

- 单个文件最大20MB
- 同时处理文件数量建议不超过10个
- 需要浏览器支持Canvas API
- 某些格式转换可能受浏览器支持限制

## 常见问题

### Q: 为什么压缩后文件大小没有明显减小？
A: 可能的原因：
- 原图已经是高度压缩的格式
- 压缩质量设置过高
- 图片尺寸较小

### Q: 支持哪些图片格式？
A: 支持JPG、PNG、WEBP、GIF等常见格式，具体支持情况取决于浏览器。

### Q: 压缩会降低图片质量吗？
A: 压缩会一定程度降低图片质量，但可以通过调节质量参数在文件大小和质量之间找到平衡。

### Q: 批量压缩的文件如何下载？
A: 多个文件会自动打包成ZIP文件下载，单个文件直接下载。

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 基础压缩功能
- 预览对比功能
- 历史记录功能
- 批量处理功能

## 技术细节

### Canvas压缩原理
```javascript
// 创建Canvas
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

// 设置尺寸
canvas.width = targetWidth;
canvas.height = targetHeight;

// 绘制图片
ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

// 转换为Blob
canvas.toBlob(callback, mimeType, quality);
```

### 尺寸计算
```javascript
// 保持比例的尺寸计算
const ratio = Math.min(maxWidth / originalWidth, maxHeight / originalHeight);
const targetWidth = Math.round(originalWidth * ratio);
const targetHeight = Math.round(originalHeight * ratio);
```

### 格式转换
```javascript
// 不同格式的MIME类型
const mimeTypes = {
    'jpeg': 'image/jpeg',
    'png': 'image/png',
    'webp': 'image/webp'
};
```

## 开发说明

### 扩展功能
- 添加更多图片格式支持
- 实现更高级的压缩算法
- 添加图片滤镜效果
- 支持图片编辑功能

### 性能优化
- 使用Web Workers处理大文件
- 实现渐进式压缩
- 添加缓存机制
- 优化内存使用

### 用户体验
- 添加更多预设参数
- 实现拖拽排序
- 添加撤销功能
- 优化移动端体验 