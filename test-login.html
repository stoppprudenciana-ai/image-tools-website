<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录功能测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.error {
            background: #dc3545;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>🔧 登录功能测试页面</h1>
    
    <div class="test-section">
        <h2>📋 测试说明</h2>
        <p>这个页面用于测试登录功能的各个组件是否正常工作。</p>
        <p><strong>演示账号：</strong></p>
        <ul>
            <li>手机号：13800138000，密码：123456</li>
            <li>手机号：13900139000，密码：123456</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>🧪 功能测试</h2>
        <button class="test-button" onclick="testLocalStorage()">测试本地存储</button>
        <button class="test-button" onclick="testUserFunctions()">测试用户函数</button>
        <button class="test-button" onclick="testModalFunctions()">测试模态框函数</button>
        <button class="test-button" onclick="testLoginProcess()">测试完整登录流程</button>
        <button class="test-button" onclick="clearAllData()">清除所有数据</button>
    </div>
    
    <div class="test-section">
        <h2>📊 测试结果</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>📝 控制台日志</h2>
        <div id="consoleLog" class="log"></div>
        <button class="test-button" onclick="clearLog()">清除日志</button>
    </div>
    
    <div class="test-section">
        <h2>🔍 当前状态</h2>
        <div id="currentStatus"></div>
    </div>

    <script>
        // 重写console.log来捕获日志
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('consoleLog');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = `[LOG] ${args.join(' ')}`;
            logEntry.style.color = '#28a745';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = `[ERROR] ${args.join(' ')}`;
            logEntry.style.color = '#dc3545';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        // 显示测试结果
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultEntry = document.createElement('div');
            resultEntry.className = `status ${type}`;
            resultEntry.textContent = message;
            resultsDiv.appendChild(resultEntry);
        }
        
        // 更新当前状态
        function updateStatus() {
            const statusDiv = document.getElementById('currentStatus');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const loginStatus = JSON.parse(localStorage.getItem('loginStatus') || '{}');
            
            let statusHTML = '<h3>用户数据</h3>';
            if (users.length > 0) {
                statusHTML += `<p>已注册用户数：${users.length}</p>`;
                users.forEach((user, index) => {
                    statusHTML += `<p>用户${index + 1}：${user.nickname} (${user.phone})</p>`;
                });
            } else {
                statusHTML += '<p>暂无注册用户</p>';
            }
            
            statusHTML += '<h3>登录状态</h3>';
            if (loginStatus.isLoggedIn) {
                statusHTML += `<p>已登录：${loginStatus.phone}</p>`;
                statusHTML += `<p>登录时间：${new Date(loginStatus.loginTime).toLocaleString()}</p>`;
            } else {
                statusHTML += '<p>未登录</p>';
            }
            
            statusDiv.innerHTML = statusHTML;
        }
        
        // 测试本地存储
        function testLocalStorage() {
            showResult('开始测试本地存储...', 'info');
            
            try {
                // 测试写入
                localStorage.setItem('testKey', 'testValue');
                showResult('✅ 本地存储写入测试通过', 'success');
                
                // 测试读取
                const value = localStorage.getItem('testKey');
                if (value === 'testValue') {
                    showResult('✅ 本地存储读取测试通过', 'success');
                } else {
                    showResult('❌ 本地存储读取测试失败', 'error');
                }
                
                // 测试删除
                localStorage.removeItem('testKey');
                const deletedValue = localStorage.getItem('testKey');
                if (deletedValue === null) {
                    showResult('✅ 本地存储删除测试通过', 'success');
                } else {
                    showResult('❌ 本地存储删除测试失败', 'error');
                }
                
            } catch (error) {
                showResult(`❌ 本地存储测试失败：${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // 测试用户函数
        function testUserFunctions() {
            showResult('开始测试用户函数...', 'info');
            
            try {
                // 测试创建演示用户
                const demoUsers = [
                    {
                        phone: '13800138000',
                        nickname: '演示用户1',
                        password: '123456',
                        registerTime: new Date().toISOString()
                    }
                ];
                
                localStorage.setItem('users', JSON.stringify(demoUsers));
                showResult('✅ 创建演示用户成功', 'success');
                
                // 测试检查手机号是否已注册
                const isRegistered = JSON.parse(localStorage.getItem('users') || '[]')
                    .some(user => user.phone === '13800138000');
                
                if (isRegistered) {
                    showResult('✅ 检查手机号注册状态成功', 'success');
                } else {
                    showResult('❌ 检查手机号注册状态失败', 'error');
                }
                
                // 测试验证用户登录
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.phone === '13800138000');
                const isValid = user && user.password === '123456';
                
                if (isValid) {
                    showResult('✅ 用户登录验证成功', 'success');
                } else {
                    showResult('❌ 用户登录验证失败', 'error');
                }
                
            } catch (error) {
                showResult(`❌ 用户函数测试失败：${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // 测试模态框函数
        function testModalFunctions() {
            showResult('开始测试模态框函数...', 'info');
            
            try {
                // 检查必要的函数是否存在
                if (typeof showLoginModal === 'function') {
                    showResult('✅ showLoginModal函数存在', 'success');
                } else {
                    showResult('❌ showLoginModal函数不存在', 'error');
                }
                
                if (typeof showRegisterModal === 'function') {
                    showResult('✅ showRegisterModal函数存在', 'success');
                } else {
                    showResult('❌ showRegisterModal函数不存在', 'error');
                }
                
                if (typeof closeModal === 'function') {
                    showResult('✅ closeModal函数存在', 'success');
                } else {
                    showResult('❌ closeModal函数不存在', 'error');
                }
                
                // 尝试调用函数（可能会失败，因为DOM元素不存在）
                try {
                    showLoginModal();
                    showResult('✅ showLoginModal函数调用成功', 'success');
                } catch (error) {
                    showResult(`⚠️ showLoginModal函数调用失败（预期行为）：${error.message}`, 'info');
                }
                
            } catch (error) {
                showResult(`❌ 模态框函数测试失败：${error.message}`, 'error');
            }
        }
        
        // 测试完整登录流程
        function testLoginProcess() {
            showResult('开始测试完整登录流程...', 'info');
            
            try {
                // 1. 创建测试用户
                const testUser = {
                    phone: '13900139000',
                    nickname: '测试用户',
                    password: '123456',
                    registerTime: new Date().toISOString()
                };
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(testUser);
                localStorage.setItem('users', JSON.stringify(users));
                showResult('✅ 创建测试用户成功', 'success');
                
                // 2. 模拟登录
                const savedUsers = JSON.parse(localStorage.getItem('users') || '[]');
                const user = savedUsers.find(u => u.phone === '13900139000');
                
                if (user && user.password === '123456') {
                    // 保存登录状态
                    localStorage.setItem('loginStatus', JSON.stringify({
                        isLoggedIn: true,
                        phone: '13900139000',
                        loginTime: new Date().toISOString()
                    }));
                    showResult('✅ 模拟登录成功', 'success');
                } else {
                    showResult('❌ 模拟登录失败', 'error');
                }
                
                // 3. 验证登录状态
                const loginStatus = JSON.parse(localStorage.getItem('loginStatus') || '{}');
                if (loginStatus.isLoggedIn && loginStatus.phone === '13900139000') {
                    showResult('✅ 登录状态验证成功', 'success');
                } else {
                    showResult('❌ 登录状态验证失败', 'error');
                }
                
            } catch (error) {
                showResult(`❌ 完整登录流程测试失败：${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // 清除所有数据
        function clearAllData() {
            if (confirm('确定要清除所有本地存储数据吗？这将删除所有用户信息和登录状态。')) {
                localStorage.clear();
                showResult('✅ 所有数据已清除', 'success');
                updateStatus();
            }
        }
        
        // 清除日志
        function clearLog() {
            document.getElementById('consoleLog').innerHTML = '';
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('测试页面加载完成');
            updateStatus();
            
            // 显示欢迎信息
            showResult('🚀 测试页面已准备就绪，请开始测试！', 'info');
        });
    </script>
</body>
</html>
