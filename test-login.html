<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.error {
            background: #dc3545;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç™»å½•åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ç™»å½•åŠŸèƒ½çš„å„ä¸ªç»„ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
        <p><strong>æ¼”ç¤ºè´¦å·ï¼š</strong></p>
        <ul>
            <li>æ‰‹æœºå·ï¼š13800138000ï¼Œå¯†ç ï¼š123456</li>
            <li>æ‰‹æœºå·ï¼š13900139000ï¼Œå¯†ç ï¼š123456</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
        <button class="test-button" onclick="testUserFunctions()">æµ‹è¯•ç”¨æˆ·å‡½æ•°</button>
        <button class="test-button" onclick="testModalFunctions()">æµ‹è¯•æ¨¡æ€æ¡†å‡½æ•°</button>
        <button class="test-button" onclick="testLoginProcess()">æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹</button>
        <button class="test-button" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="consoleLog" class="log"></div>
        <button class="test-button" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” å½“å‰çŠ¶æ€</h2>
        <div id="currentStatus"></div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('consoleLog');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = `[LOG] ${args.join(' ')}`;
            logEntry.style.color = '#28a745';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = `[ERROR] ${args.join(' ')}`;
            logEntry.style.color = '#dc3545';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultEntry = document.createElement('div');
            resultEntry.className = `status ${type}`;
            resultEntry.textContent = message;
            resultsDiv.appendChild(resultEntry);
        }
        
        // æ›´æ–°å½“å‰çŠ¶æ€
        function updateStatus() {
            const statusDiv = document.getElementById('currentStatus');
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const loginStatus = JSON.parse(localStorage.getItem('loginStatus') || '{}');
            
            let statusHTML = '<h3>ç”¨æˆ·æ•°æ®</h3>';
            if (users.length > 0) {
                statusHTML += `<p>å·²æ³¨å†Œç”¨æˆ·æ•°ï¼š${users.length}</p>`;
                users.forEach((user, index) => {
                    statusHTML += `<p>ç”¨æˆ·${index + 1}ï¼š${user.nickname} (${user.phone})</p>`;
                });
            } else {
                statusHTML += '<p>æš‚æ— æ³¨å†Œç”¨æˆ·</p>';
            }
            
            statusHTML += '<h3>ç™»å½•çŠ¶æ€</h3>';
            if (loginStatus.isLoggedIn) {
                statusHTML += `<p>å·²ç™»å½•ï¼š${loginStatus.phone}</p>`;
                statusHTML += `<p>ç™»å½•æ—¶é—´ï¼š${new Date(loginStatus.loginTime).toLocaleString()}</p>`;
            } else {
                statusHTML += '<p>æœªç™»å½•</p>';
            }
            
            statusDiv.innerHTML = statusHTML;
        }
        
        // æµ‹è¯•æœ¬åœ°å­˜å‚¨
        function testLocalStorage() {
            showResult('å¼€å§‹æµ‹è¯•æœ¬åœ°å­˜å‚¨...', 'info');
            
            try {
                // æµ‹è¯•å†™å…¥
                localStorage.setItem('testKey', 'testValue');
                showResult('âœ… æœ¬åœ°å­˜å‚¨å†™å…¥æµ‹è¯•é€šè¿‡', 'success');
                
                // æµ‹è¯•è¯»å–
                const value = localStorage.getItem('testKey');
                if (value === 'testValue') {
                    showResult('âœ… æœ¬åœ°å­˜å‚¨è¯»å–æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    showResult('âŒ æœ¬åœ°å­˜å‚¨è¯»å–æµ‹è¯•å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•åˆ é™¤
                localStorage.removeItem('testKey');
                const deletedValue = localStorage.getItem('testKey');
                if (deletedValue === null) {
                    showResult('âœ… æœ¬åœ°å­˜å‚¨åˆ é™¤æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    showResult('âŒ æœ¬åœ°å­˜å‚¨åˆ é™¤æµ‹è¯•å¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult(`âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æµ‹è¯•ç”¨æˆ·å‡½æ•°
        function testUserFunctions() {
            showResult('å¼€å§‹æµ‹è¯•ç”¨æˆ·å‡½æ•°...', 'info');
            
            try {
                // æµ‹è¯•åˆ›å»ºæ¼”ç¤ºç”¨æˆ·
                const demoUsers = [
                    {
                        phone: '13800138000',
                        nickname: 'æ¼”ç¤ºç”¨æˆ·1',
                        password: '123456',
                        registerTime: new Date().toISOString()
                    }
                ];
                
                localStorage.setItem('users', JSON.stringify(demoUsers));
                showResult('âœ… åˆ›å»ºæ¼”ç¤ºç”¨æˆ·æˆåŠŸ', 'success');
                
                // æµ‹è¯•æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²æ³¨å†Œ
                const isRegistered = JSON.parse(localStorage.getItem('users') || '[]')
                    .some(user => user.phone === '13800138000');
                
                if (isRegistered) {
                    showResult('âœ… æ£€æŸ¥æ‰‹æœºå·æ³¨å†ŒçŠ¶æ€æˆåŠŸ', 'success');
                } else {
                    showResult('âŒ æ£€æŸ¥æ‰‹æœºå·æ³¨å†ŒçŠ¶æ€å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•éªŒè¯ç”¨æˆ·ç™»å½•
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.phone === '13800138000');
                const isValid = user && user.password === '123456';
                
                if (isValid) {
                    showResult('âœ… ç”¨æˆ·ç™»å½•éªŒè¯æˆåŠŸ', 'success');
                } else {
                    showResult('âŒ ç”¨æˆ·ç™»å½•éªŒè¯å¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult(`âŒ ç”¨æˆ·å‡½æ•°æµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æµ‹è¯•æ¨¡æ€æ¡†å‡½æ•°
        function testModalFunctions() {
            showResult('å¼€å§‹æµ‹è¯•æ¨¡æ€æ¡†å‡½æ•°...', 'info');
            
            try {
                // æ£€æŸ¥å¿…è¦çš„å‡½æ•°æ˜¯å¦å­˜åœ¨
                if (typeof showLoginModal === 'function') {
                    showResult('âœ… showLoginModalå‡½æ•°å­˜åœ¨', 'success');
                } else {
                    showResult('âŒ showLoginModalå‡½æ•°ä¸å­˜åœ¨', 'error');
                }
                
                if (typeof showRegisterModal === 'function') {
                    showResult('âœ… showRegisterModalå‡½æ•°å­˜åœ¨', 'success');
                } else {
                    showResult('âŒ showRegisterModalå‡½æ•°ä¸å­˜åœ¨', 'error');
                }
                
                if (typeof closeModal === 'function') {
                    showResult('âœ… closeModalå‡½æ•°å­˜åœ¨', 'success');
                } else {
                    showResult('âŒ closeModalå‡½æ•°ä¸å­˜åœ¨', 'error');
                }
                
                // å°è¯•è°ƒç”¨å‡½æ•°ï¼ˆå¯èƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºDOMå…ƒç´ ä¸å­˜åœ¨ï¼‰
                try {
                    showLoginModal();
                    showResult('âœ… showLoginModalå‡½æ•°è°ƒç”¨æˆåŠŸ', 'success');
                } catch (error) {
                    showResult(`âš ï¸ showLoginModalå‡½æ•°è°ƒç”¨å¤±è´¥ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰ï¼š${error.message}`, 'info');
                }
                
            } catch (error) {
                showResult(`âŒ æ¨¡æ€æ¡†å‡½æ•°æµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹
        function testLoginProcess() {
            showResult('å¼€å§‹æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹...', 'info');
            
            try {
                // 1. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
                const testUser = {
                    phone: '13900139000',
                    nickname: 'æµ‹è¯•ç”¨æˆ·',
                    password: '123456',
                    registerTime: new Date().toISOString()
                };
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(testUser);
                localStorage.setItem('users', JSON.stringify(users));
                showResult('âœ… åˆ›å»ºæµ‹è¯•ç”¨æˆ·æˆåŠŸ', 'success');
                
                // 2. æ¨¡æ‹Ÿç™»å½•
                const savedUsers = JSON.parse(localStorage.getItem('users') || '[]');
                const user = savedUsers.find(u => u.phone === '13900139000');
                
                if (user && user.password === '123456') {
                    // ä¿å­˜ç™»å½•çŠ¶æ€
                    localStorage.setItem('loginStatus', JSON.stringify({
                        isLoggedIn: true,
                        phone: '13900139000',
                        loginTime: new Date().toISOString()
                    }));
                    showResult('âœ… æ¨¡æ‹Ÿç™»å½•æˆåŠŸ', 'success');
                } else {
                    showResult('âŒ æ¨¡æ‹Ÿç™»å½•å¤±è´¥', 'error');
                }
                
                // 3. éªŒè¯ç™»å½•çŠ¶æ€
                const loginStatus = JSON.parse(localStorage.getItem('loginStatus') || '{}');
                if (loginStatus.isLoggedIn && loginStatus.phone === '13900139000') {
                    showResult('âœ… ç™»å½•çŠ¶æ€éªŒè¯æˆåŠŸ', 'success');
                } else {
                    showResult('âŒ ç™»å½•çŠ¶æ€éªŒè¯å¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult(`âŒ å®Œæ•´ç™»å½•æµç¨‹æµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯å’Œç™»å½•çŠ¶æ€ã€‚')) {
                localStorage.clear();
                showResult('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤', 'success');
                updateStatus();
            }
        }
        
        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            document.getElementById('consoleLog').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            updateStatus();
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            showResult('ğŸš€ æµ‹è¯•é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œè¯·å¼€å§‹æµ‹è¯•ï¼', 'info');
        });
    </script>
</body>
</html>
