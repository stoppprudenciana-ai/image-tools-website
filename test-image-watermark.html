<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ°´å°åŠŸèƒ½æµ‹è¯•</title>
    <meta name="description" content="æµ‹è¯•å›¾ç‰‡æ°´å°åŠŸèƒ½çš„å„é¡¹ç‰¹æ€§">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/image-watermark.css">
    
    <!-- å­—ä½“å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-item {
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-item h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .test-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">
                    <i class="fas fa-tools"></i>
                    <span>å›¾æ–‡æ ¼å¼è½¬æ¢å·¥å…·</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="pages/file-convert.html" class="nav-link">æ–‡ä»¶è½¬æ¢</a></li>
                <li><a href="pages/image-compress.html" class="nav-link">å›¾ç‰‡å‹ç¼©</a></li>
                <li><a href="pages/image-crop.html" class="nav-link">å›¾ç‰‡è£å‰ª</a></li>
                <li><a href="pages/image-convert.html" class="nav-link">æ ¼å¼è½¬æ¢</a></li>
                <li><a href="pages/image-watermark.html" class="nav-link">å›¾ç‰‡æ°´å°</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <div class="container">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-vial"></i>
                    å›¾ç‰‡æ°´å°åŠŸèƒ½æµ‹è¯•
                </h1>
                <p class="page-subtitle">æµ‹è¯•å›¾ç‰‡æ°´å°åŠŸèƒ½çš„å„é¡¹ç‰¹æ€§å’Œæ€§èƒ½</p>
            </div>

            <!-- åŠŸèƒ½æµ‹è¯•åŒºåŸŸ -->
            <div class="test-section">
                <h3 class="section-title">åŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-grid">
                    <div class="test-item">
                        <h4>Canvas API æ”¯æŒ</h4>
                        <p>æµ‹è¯•æµè§ˆå™¨æ˜¯å¦æ”¯æŒCanvas APIï¼Œè¿™æ˜¯æ°´å°åŠŸèƒ½çš„æ ¸å¿ƒ</p>
                        <div id="canvasTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>æ–‡ä»¶API æ”¯æŒ</h4>
                        <p>æµ‹è¯•æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œæ‹–æ‹½åŠŸèƒ½</p>
                        <div id="fileApiTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>JSZip åº“åŠ è½½</h4>
                        <p>æµ‹è¯•JSZipåº“æ˜¯å¦æ­£ç¡®åŠ è½½ï¼Œç”¨äºæ‰¹é‡ä¸‹è½½</p>
                        <div id="jszipTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>å›¾ç‰‡å¤„ç†æ€§èƒ½</h4>
                        <p>æµ‹è¯•å›¾ç‰‡å¤„ç†çš„é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ</p>
                        <div id="performanceTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>æ°´å°æ¸²æŸ“æµ‹è¯•</h4>
                        <p>æµ‹è¯•æ–‡å­—æ°´å°å’Œå›¾ç‰‡æ°´å°çš„æ¸²æŸ“æ•ˆæœ</p>
                        <div id="watermarkRenderTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>ä½ç½®è®¡ç®—æµ‹è¯•</h4>
                        <p>æµ‹è¯•æ°´å°ä½ç½®è®¡ç®—çš„å‡†ç¡®æ€§</p>
                        <div id="positionTest" class="test-result"></div>
                    </div>
                </div>
            </div>

            <!-- å®é™…åŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <h3 class="section-title">å®é™…åŠŸèƒ½æµ‹è¯•</h3>
                <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å®é™…çš„æ°´å°åŠŸèƒ½</p>
                
                <div class="action-section">
                    <button class="btn btn-primary" id="testTextWatermark">
                        <i class="fas fa-font"></i>
                        æµ‹è¯•æ–‡å­—æ°´å°
                    </button>
                    <button class="btn btn-success" id="testImageWatermark">
                        <i class="fas fa-image"></i>
                        æµ‹è¯•å›¾ç‰‡æ°´å°
                    </button>
                    <button class="btn btn-info" id="testBatchProcess">
                        <i class="fas fa-layer-group"></i>
                        æµ‹è¯•æ‰¹é‡å¤„ç†
                    </button>
                    <button class="btn btn-warning" id="testDownload">
                        <i class="fas fa-download"></i>
                        æµ‹è¯•ä¸‹è½½åŠŸèƒ½
                    </button>
                </div>
                
                <div id="testResults" class="test-results"></div>
            </div>

            <!-- æ€§èƒ½æµ‹è¯• -->
            <div class="test-section">
                <h3 class="section-title">æ€§èƒ½æµ‹è¯•</h3>
                <div class="test-grid">
                    <div class="test-item">
                        <h4>å¤§å›¾ç‰‡å¤„ç†</h4>
                        <p>æµ‹è¯•å¤„ç†å¤§å°ºå¯¸å›¾ç‰‡çš„æ€§èƒ½</p>
                        <button class="btn btn-secondary" id="testLargeImage">æµ‹è¯•å¤§å›¾ç‰‡</button>
                        <div id="largeImageTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>å¤šæ–‡ä»¶å¤„ç†</h4>
                        <p>æµ‹è¯•åŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶çš„æ€§èƒ½</p>
                        <button class="btn btn-secondary" id="testMultipleFiles">æµ‹è¯•å¤šæ–‡ä»¶</button>
                        <div id="multipleFilesTest" class="test-result"></div>
                    </div>
                    
                    <div class="test-item">
                        <h4>å†…å­˜ä½¿ç”¨</h4>
                        <p>ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</p>
                        <div id="memoryTest" class="test-result"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ç¬¬ä¸‰æ–¹åº“ -->
    <script src="lib/jszip.js"></script>
    
    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="js/common.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/image-watermark.js"></script>
    
    <script>
        // æµ‹è¯•åŠŸèƒ½
        class WatermarkTester {
            constructor() {
                this.runTests();
                this.bindTestEvents();
            }

            runTests() {
                this.testCanvasSupport();
                this.testFileApiSupport();
                this.testJSZipSupport();
                this.testPerformance();
                this.testWatermarkRendering();
                this.testPositionCalculation();
                this.monitorMemory();
            }

            testCanvasSupport() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const result = document.getElementById('canvasTest');
                
                if (ctx) {
                    result.className = 'test-result test-success';
                    result.innerHTML = 'âœ… Canvas API æ”¯æŒæ­£å¸¸';
                } else {
                    result.className = 'test-result test-error';
                    result.innerHTML = 'âŒ Canvas API ä¸æ”¯æŒ';
                }
            }

            testFileApiSupport() {
                const result = document.getElementById('fileApiTest');
                
                if (window.File && window.FileReader && window.FileList && window.Blob) {
                    result.className = 'test-result test-success';
                    result.innerHTML = 'âœ… æ–‡ä»¶API æ”¯æŒæ­£å¸¸';
                } else {
                    result.className = 'test-result test-error';
                    result.innerHTML = 'âŒ æ–‡ä»¶API ä¸æ”¯æŒ';
                }
            }

            testJSZipSupport() {
                const result = document.getElementById('jszipTest');
                
                if (typeof JSZip !== 'undefined') {
                    result.className = 'test-result test-success';
                    result.innerHTML = 'âœ… JSZip åº“åŠ è½½æˆåŠŸ';
                } else {
                    result.className = 'test-result test-error';
                    result.innerHTML = 'âŒ JSZip åº“æœªåŠ è½½';
                }
            }

            testPerformance() {
                const result = document.getElementById('performanceTest');
                const startTime = performance.now();
                
                // åˆ›å»ºä¸€ä¸ªæµ‹è¯•canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 1000;
                canvas.height = 1000;
                
                // ç»˜åˆ¶ä¸€äº›å†…å®¹
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, 1000, 1000);
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                result.className = 'test-result test-info';
                result.innerHTML = `â±ï¸ æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${duration.toFixed(2)}ms`;
            }

            testWatermarkRendering() {
                const result = document.getElementById('watermarkRenderTest');
                
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 200;
                    canvas.height = 200;
                    
                    // æµ‹è¯•æ–‡å­—æ°´å°
                    ctx.fillStyle = '#f0f0f0';
                    ctx.fillRect(0, 0, 200, 200);
                    ctx.fillStyle = '#000000';
                    ctx.font = '20px Arial';
                    ctx.fillText('æµ‹è¯•æ°´å°', 100, 100);
                    
                    result.className = 'test-result test-success';
                    result.innerHTML = 'âœ… æ°´å°æ¸²æŸ“æµ‹è¯•é€šè¿‡';
                } catch (error) {
                    result.className = 'test-result test-error';
                    result.innerHTML = 'âŒ æ°´å°æ¸²æŸ“æµ‹è¯•å¤±è´¥: ' + error.message;
                }
            }

            testPositionCalculation() {
                const result = document.getElementById('positionTest');
                
                try {
                    // æµ‹è¯•ä½ç½®è®¡ç®—
                    const positions = [
                        { h: 'left', v: 'top' },
                        { h: 'center', v: 'center' },
                        { h: 'right', v: 'bottom' }
                    ];
                    
                    const canvasWidth = 1000;
                    const canvasHeight = 800;
                    
                    positions.forEach(pos => {
                        let x, y;
                        
                        switch (pos.h) {
                            case 'left': x = 50; break;
                            case 'center': x = canvasWidth / 2; break;
                            case 'right': x = canvasWidth - 50; break;
                        }
                        
                        switch (pos.v) {
                            case 'top': y = 50; break;
                            case 'center': y = canvasHeight / 2; break;
                            case 'bottom': y = canvasHeight - 50; break;
                        }
                        
                        if (x < 0 || x > canvasWidth || y < 0 || y > canvasHeight) {
                            throw new Error('ä½ç½®è®¡ç®—é”™è¯¯');
                        }
                    });
                    
                    result.className = 'test-result test-success';
                    result.innerHTML = 'âœ… ä½ç½®è®¡ç®—æµ‹è¯•é€šè¿‡';
                } catch (error) {
                    result.className = 'test-result test-error';
                    result.innerHTML = 'âŒ ä½ç½®è®¡ç®—æµ‹è¯•å¤±è´¥: ' + error.message;
                }
            }

            monitorMemory() {
                const result = document.getElementById('memoryTest');
                
                if (performance.memory) {
                    const memory = performance.memory;
                    const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                    
                    result.className = 'test-result test-info';
                    result.innerHTML = `ğŸ’¾ å†…å­˜ä½¿ç”¨: ${usedMB}MB / ${totalMB}MB`;
                } else {
                    result.className = 'test-result test-info';
                    result.innerHTML = 'ğŸ’¾ å†…å­˜ä¿¡æ¯ä¸å¯ç”¨';
                }
            }

            bindTestEvents() {
                document.getElementById('testTextWatermark').addEventListener('click', () => {
                    this.testTextWatermarkFunction();
                });
                
                document.getElementById('testImageWatermark').addEventListener('click', () => {
                    this.testImageWatermarkFunction();
                });
                
                document.getElementById('testBatchProcess').addEventListener('click', () => {
                    this.testBatchProcessFunction();
                });
                
                document.getElementById('testDownload').addEventListener('click', () => {
                    this.testDownloadFunction();
                });
                
                document.getElementById('testLargeImage').addEventListener('click', () => {
                    this.testLargeImageFunction();
                });
                
                document.getElementById('testMultipleFiles').addEventListener('click', () => {
                    this.testMultipleFilesFunction();
                });
            }

            testTextWatermarkFunction() {
                const results = document.getElementById('testResults');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•æ–‡å­—æ°´å°åŠŸèƒ½...</div>';
                
                try {
                    // åˆ›å»ºæµ‹è¯•å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 400;
                    canvas.height = 300;
                    
                    // ç»˜åˆ¶èƒŒæ™¯
                    ctx.fillStyle = '#f0f0f0';
                    ctx.fillRect(0, 0, 400, 300);
                    
                    // æ·»åŠ æ–‡å­—æ°´å°
                    ctx.globalAlpha = 0.5;
                    ctx.fillStyle = '#000000';
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('æµ‹è¯•æ°´å°', 200, 150);
                    
                    results.innerHTML = '<div class="test-result test-success">âœ… æ–‡å­—æ°´å°æµ‹è¯•æˆåŠŸ</div>';
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ æ–‡å­—æ°´å°æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }

            testImageWatermarkFunction() {
                const results = document.getElementById('testResults');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•å›¾ç‰‡æ°´å°åŠŸèƒ½...</div>';
                
                try {
                    // åˆ›å»ºæµ‹è¯•å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 400;
                    canvas.height = 300;
                    
                    // ç»˜åˆ¶èƒŒæ™¯
                    ctx.fillStyle = '#f0f0f0';
                    ctx.fillRect(0, 0, 400, 300);
                    
                    // åˆ›å»ºç®€å•çš„æ°´å°å›¾æ¡ˆ
                    ctx.globalAlpha = 0.3;
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(150, 100, 100, 100);
                    
                    results.innerHTML = '<div class="test-result test-success">âœ… å›¾ç‰‡æ°´å°æµ‹è¯•æˆåŠŸ</div>';
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ å›¾ç‰‡æ°´å°æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }

            testBatchProcessFunction() {
                const results = document.getElementById('testResults');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•æ‰¹é‡å¤„ç†åŠŸèƒ½...</div>';
                
                try {
                    // æ¨¡æ‹Ÿæ‰¹é‡å¤„ç†
                    const testFiles = [
                        { name: 'test1.jpg', size: 1024 * 1024 },
                        { name: 'test2.png', size: 2048 * 1024 },
                        { name: 'test3.webp', size: 512 * 1024 }
                    ];
                    
                    setTimeout(() => {
                        results.innerHTML = `<div class="test-result test-success">âœ… æ‰¹é‡å¤„ç†æµ‹è¯•æˆåŠŸï¼Œæ¨¡æ‹Ÿå¤„ç†äº† ${testFiles.length} ä¸ªæ–‡ä»¶</div>`;
                    }, 1000);
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ æ‰¹é‡å¤„ç†æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }

            testDownloadFunction() {
                const results = document.getElementById('testResults');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•ä¸‹è½½åŠŸèƒ½...</div>';
                
                try {
                    // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 200;
                    canvas.height = 200;
                    
                    ctx.fillStyle = '#f0f0f0';
                    ctx.fillRect(0, 0, 200, 200);
                    ctx.fillStyle = '#000000';
                    ctx.font = '20px Arial';
                    ctx.fillText('æµ‹è¯•ä¸‹è½½', 100, 100);
                    
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'test_watermark.png';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        results.innerHTML = '<div class="test-result test-success">âœ… ä¸‹è½½åŠŸèƒ½æµ‹è¯•æˆåŠŸ</div>';
                    });
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ ä¸‹è½½åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }

            testLargeImageFunction() {
                const results = document.getElementById('largeImageTest');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•å¤§å›¾ç‰‡å¤„ç†...</div>';
                
                try {
                    const startTime = performance.now();
                    
                    // åˆ›å»ºå¤§å°ºå¯¸æµ‹è¯•å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 2000;
                    canvas.height = 1500;
                    
                    // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
                    const gradient = ctx.createLinearGradient(0, 0, 2000, 1500);
                    gradient.addColorStop(0, '#ff6b6b');
                    gradient.addColorStop(1, '#4ecdc4');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, 2000, 1500);
                    
                    // æ·»åŠ æ°´å°
                    ctx.globalAlpha = 0.3;
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '48px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('å¤§å›¾ç‰‡æµ‹è¯•', 1000, 750);
                    
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    
                    results.innerHTML = `<div class="test-result test-success">âœ… å¤§å›¾ç‰‡å¤„ç†æµ‹è¯•æˆåŠŸï¼Œè€—æ—¶: ${duration.toFixed(2)}ms</div>`;
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ å¤§å›¾ç‰‡å¤„ç†æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }

            testMultipleFilesFunction() {
                const results = document.getElementById('multipleFilesTest');
                results.innerHTML = '<div class="test-result test-info">æ­£åœ¨æµ‹è¯•å¤šæ–‡ä»¶å¤„ç†...</div>';
                
                try {
                    const startTime = performance.now();
                    const fileCount = 5;
                    let processedCount = 0;
                    
                    for (let i = 0; i < fileCount; i++) {
                        setTimeout(() => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            canvas.width = 400;
                            canvas.height = 300;
                            
                            ctx.fillStyle = '#f0f0f0';
                            ctx.fillRect(0, 0, 400, 300);
                            ctx.fillStyle = '#000000';
                            ctx.font = '20px Arial';
                            ctx.fillText(`æ–‡ä»¶ ${i + 1}`, 200, 150);
                            
                            processedCount++;
                            
                            if (processedCount === fileCount) {
                                const endTime = performance.now();
                                const duration = endTime - startTime;
                                results.innerHTML = `<div class="test-result test-success">âœ… å¤šæ–‡ä»¶å¤„ç†æµ‹è¯•æˆåŠŸï¼Œå¤„ç†äº† ${fileCount} ä¸ªæ–‡ä»¶ï¼Œè€—æ—¶: ${duration.toFixed(2)}ms</div>`;
                            }
                        }, i * 100);
                    }
                } catch (error) {
                    results.innerHTML = `<div class="test-result test-error">âŒ å¤šæ–‡ä»¶å¤„ç†æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            new WatermarkTester();
        });
    </script>
</body>
</html> 